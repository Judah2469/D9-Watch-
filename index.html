<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D9: Citizen Watch</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        #map { height: 55vh; width: 100%; z-index: 0; }
        .glass-panel { background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(10px); border-top: 1px solid rgba(255,255,255,0.1); }
        .btn-action { transition: all 0.2s; active: scale-95; }
        
        /* Custom Map Markers */
        .marker-pin {
            width: 30px; height: 30px; border-radius: 50% 50% 50% 0; background: #c30b82; position: absolute; transform: rotate(-45deg);
            left: 50%; top: 50%; margin: -15px 0 0 -15px;
        }
        .marker-pin::after {
            content: ''; width: 14px; height: 14px; margin: 8px 0 0 8px; background: #fff; position: absolute; border-radius: 50%;
        }
    </style>
</head>
<body class="overflow-hidden h-screen flex flex-col">

    <header class="bg-slate-900 border-b border-slate-700 p-4 flex justify-between items-center z-20 shadow-lg">
        <div>
            <h1 class="text-xl font-bold tracking-tighter text-white">D9 <span class="text-blue-500">WATCH</span></h1>
            <p class="text-[10px] text-slate-400 uppercase tracking-widest">Powered by Quan for Council</p>
        </div>
        <div class="h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-xs">QS</div>
    </header>

    <div id="map" class="flex-grow bg-slate-800 relative">
        <div class="absolute top-4 left-4 z-[400] space-y-2 pointer-events-none">
            <div id="feed-container">
                </div>
        </div>
    </div>

    <div class="glass-panel pb-8 pt-4 px-6 rounded-t-3xl -mt-6 z-10 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]">
        <div class="w-12 h-1 bg-slate-600 rounded-full mx-auto mb-6"></div>
        
        <h2 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-widest text-center">Report Issue to Council</h2>
        
        <div class="grid grid-cols-3 gap-4">
            <button onclick="dropPin('pothole')" class="btn-action flex flex-col items-center gap-2 group">
                <div class="w-16 h-16 rounded-2xl bg-slate-800 border border-slate-600 flex items-center justify-center group-hover:border-orange-500 group-hover:bg-slate-700 transition-colors shadow-lg">
                    <i class="fa-solid fa-road text-2xl text-orange-500"></i>
                </div>
                <span class="text-[10px] font-semibold uppercase text-slate-300">Pothole</span>
            </button>

            <button onclick="dropPin('dumping')" class="btn-action flex flex-col items-center gap-2 group">
                <div class="w-16 h-16 rounded-2xl bg-slate-800 border border-slate-600 flex items-center justify-center group-hover:border-red-500 group-hover:bg-slate-700 transition-colors shadow-lg">
                    <i class="fa-solid fa-trash text-2xl text-red-500"></i>
                </div>
                <span class="text-[10px] font-semibold uppercase text-slate-300">Dumping</span>
            </button>

            <button onclick="dropPin('light')" class="btn-action flex flex-col items-center gap-2 group">
                <div class="w-16 h-16 rounded-2xl bg-slate-800 border border-slate-600 flex items-center justify-center group-hover:border-yellow-400 group-hover:bg-slate-700 transition-colors shadow-lg">
                    <i class="fa-solid fa-lightbulb text-2xl text-yellow-400"></i>
                </div>
                <span class="text-[10px] font-semibold uppercase text-slate-300">Outage</span>
            </button>
        </div>

        <div class="mt-8 bg-slate-800/50 rounded-lg p-3 flex justify-between items-center border border-slate-700">
            <div class="text-center w-1/3 border-r border-slate-700">
                <span class="block text-xl font-bold text-white" id="stat-open">142</span>
                <span class="text-[9px] text-slate-400 uppercase">Open Issues</span>
            </div>
            <div class="text-center w-1/3 border-r border-slate-700">
                <span class="block text-xl font-bold text-green-400">89%</span>
                <span class="text-[9px] text-slate-400 uppercase">Resolved</span>
            </div>
            <div class="text-center w-1/3">
                <span class="block text-xl font-bold text-blue-400">D9</span>
                <span class="text-[9px] text-slate-400 uppercase">Target Zone</span>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // --- 1. INITIALIZE MAP (Focused on Clinton/Fort Washington) ---
        // Coordinates for Clinton, MD
        const startLat = 38.766; 
        const startLng = -76.898; 
        
        const map = L.map('map', { zoomControl: false }).setView([startLat, startLng], 13);

        // Dark Mode Map Tiles (CartoDB Dark Matter)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // --- 2. DEMO DATA (Fake existing reports) ---
        const demoPoints = [
            { lat: 38.768, lng: -76.902, type: 'pothole' },
            { lat: 38.762, lng: -76.890, type: 'dumping' },
            { lat: 38.770, lng: -76.885, type: 'light' }
        ];

        // Icons
        const getIcon = (type) => {
            let color = type === 'pothole' ? '#f97316' : type === 'dumping' ? '#ef4444' : '#facc15';
            return L.divIcon({
                className: 'custom-div-icon',
                html: `<div style="background-color:${color}" class="w-3 h-3 rounded-full shadow-[0_0_10px_${color}] border-2 border-white"></div>`,
                iconSize: [12, 12],
                iconAnchor: [6, 6]
            });
        };

        // Add Demo Points
        demoPoints.forEach(pt => {
            L.marker([pt.lat, pt.lng], { icon: getIcon(pt.type) }).addTo(map);
        });

        // --- 3. INTERACTION LOGIC ---
        function dropPin(type) {
            // Get center of current view to "simulate" GPS
            const center = map.getCenter();
            
            // Add a little random offset so pins don't stack perfectly
            const lat = center.lat + (Math.random() - 0.5) * 0.005;
            const lng = center.lng + (Math.random() - 0.5) * 0.005;

            // Add Marker
            const marker = L.marker([lat, lng], { icon: getIcon(type) }).addTo(map);
            
            // Pan map slightly
            map.flyTo([lat, lng], 14, { duration: 1 });

            // Add to "Live Feed"
            addToFeed(type);

            // Update stats
            const statEl = document.getElementById('stat-open');
            let count = parseInt(statEl.innerText);
            statEl.innerText = count + 1;

            // Simple Haptic Feedback (Vibrate phone)
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function addToFeed(type) {
            const container = document.getElementById('feed-container');
            
            const item = document.createElement('div');
            item.className = "bg-slate-900/80 backdrop-blur text-white text-[10px] py-1 px-3 rounded-full border border-slate-700 animate-in fade-in slide-in-from-left duration-500 shadow-lg flex items-center gap-2";
            
            let label = type === 'pothole' ? 'POTHOLE REPORTED' : type === 'dumping' ? 'ILLEGAL DUMPING' : 'OUTAGE REPORTED';
            let color = type === 'pothole' ? 'bg-orange-500' : type === 'dumping' ? 'bg-red-500' : 'bg-yellow-500';
            
            item.innerHTML = `<span class="w-2 h-2 rounded-full ${color} animate-pulse"></span> ${label} <span class="text-slate-500 ml-1">Just now</span>`;
            
            container.prepend(item);

            // Remove after 4 seconds to keep clean
            setTimeout(() => {
                item.classList.add('opacity-0');
                setTimeout(() => item.remove(), 500);
            }, 4000);
        }
    </script>
</body>
</html>